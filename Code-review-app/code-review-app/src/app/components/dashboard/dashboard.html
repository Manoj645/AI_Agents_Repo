<div class="dashboard">
  <!-- Loading spinner -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Loading pull requests...</p>
  </div>

  <!-- Error message -->
  <div *ngIf="error && !loading" class="error-container">
    <mat-icon color="warn">error</mat-icon>
    <p>{{ error }}</p>
    <button mat-raised-button color="primary" (click)="refreshData()">Retry</button>
  </div>

  <!-- Main content -->
  <div *ngIf="!loading && !error">
    <mat-card class="welcome-card">
      <mat-card-header>
        <mat-card-title>Welcome to AI Code Review Agent</mat-card-title>
        <mat-card-subtitle>Intelligent code review powered by OpenAI GPT-4 and custom rules</mat-card-subtitle>
      </mat-card-header>
    </mat-card>

    <div class="stats-grid">
      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-content">
            <mat-icon class="stat-icon" color="primary">check_circle</mat-icon>
            <div class="stat-text">
              <h3>Total Pull Requests</h3>
              <p class="stat-number">{{prCount}}</p>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-content">
            <mat-icon class="stat-icon" color="accent">lightbulb</mat-icon>
            <div class="stat-text">
              <h3>Open PRs</h3>
              <p class="stat-number">{{openPRs.length}}</p>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-content">
            <mat-icon class="stat-icon" color="warn">warning</mat-icon>
            <div class="stat-text">
              <h3>Suggestions</h3>
              <p class="stat-number">{{suggestionCount}}</p>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <div class="content-grid">
      <!-- Open Pull Requests -->
      <mat-card class="content-card">
        <mat-card-header>
          <mat-card-title>Open Pull Requests</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div *ngIf="openPRs.length > 0; else noOpenPRs" class="pr-list">
            <mat-list>
              <mat-list-item *ngFor="let pr of openPRs" class="pr-item">
                <div class="pr-content">
                  <div class="pr-info">
                    <h4 class="pr-title">{{pr.title}}</h4>
                    <p class="pr-meta">#{{pr.pr_number}} by {{pr.author}} • {{pr.repository}}</p>
                    <p class="pr-description" *ngIf="pr.description">{{pr.description}}</p>
                  </div>
                  <div class="pr-actions">
                    <mat-chip [color]="getStatusColor(pr.status)" selected>
                      {{pr.status}}
                    </mat-chip>
                    <button mat-icon-button (click)="triggerReview(pr.id)" 
                            matTooltip="Trigger AI Review"
                            [disabled]="reviewLoading.get(pr.id)">
                      <mat-spinner *ngIf="reviewLoading.get(pr.id)" diameter="20" class="button-spinner"></mat-spinner>
                      <mat-icon *ngIf="!reviewLoading.get(pr.id)">play_arrow</mat-icon>
                    </button>
                  </div>
                </div>
              </mat-list-item>
            </mat-list>
          </div>
          <ng-template #noOpenPRs>
            <div class="no-data">
              <mat-icon color="disabled">inbox</mat-icon>
              <p>No open pull requests found</p>
            </div>
          </ng-template>
        </mat-card-content>
      </mat-card>

      <!-- Recent Pull Requests -->
      <mat-card class="content-card">
        <mat-card-header>
          <mat-card-title>Recent Pull Requests</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div *ngIf="recentPRs.length > 0; else noPRs" class="pr-list">
            <mat-list>
              <mat-list-item *ngFor="let pr of recentPRs" class="pr-item">
                <div class="pr-content">
                  <div class="pr-info">
                    <h4 class="pr-title">{{pr.title}}</h4>
                    <p class="pr-meta">#{{pr.pr_number}} by {{pr.author}} • {{pr.repository}}</p>
                  </div>
                  <mat-chip [color]="getStatusColor(pr.status)" selected>
                    {{pr.status}}
                  </mat-chip>
                </div>
              </mat-list-item>
            </mat-list>
          </div>
          <ng-template #noPRs>
            <div class="no-data">
              <mat-icon color="disabled">inbox</mat-icon>
              <p>No pull requests found</p>
            </div>
          </ng-template>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Quick Actions -->
    <mat-card class="content-card">
      <mat-card-header>
        <mat-card-title>Quick Actions</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="action-buttons">
          <button mat-raised-button color="primary" routerLink="/prs" class="action-button">
            <mat-icon>list</mat-icon>
            View All Pull Requests
          </button>
          <button mat-raised-button color="accent" routerLink="/reviews" class="action-button">
            <mat-icon>rate_review</mat-icon>
            View Code Reviews
          </button>
          <button mat-raised-button color="warn" routerLink="/custom-rules" class="action-button">
            <mat-icon>rule</mat-icon>
            Manage Custom Rules
          </button>
          <button mat-stroked-button (click)="refreshData()" class="action-button">
            <mat-icon>refresh</mat-icon>
            Refresh Data
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
